feature: replication
description: Tests for replication operator {n{expr}} (LRM 11.4.12.1)

cases:
  - name: replicate_byte_4_times
    sv: |
      module Test;
        byte x;
        bit [31:0] result;
        initial begin
          x = 8'hAB;
          result = {4{x}};
        end
      endmodule
    expect:
      variables:
        result: "32'hABABABAB"

  - name: replicate_nibble_4_times
    sv: |
      module Test;
        bit [3:0] x;
        bit [15:0] result;
        initial begin
          x = 4'hF;
          result = {4{x}};
        end
      endmodule
    expect:
      variables:
        result: "16'hFFFF"

  - name: replicate_single_bit
    sv: |
      module Test;
        bit x;
        bit [7:0] result;
        initial begin
          x = 1'b1;
          result = {8{x}};
        end
      endmodule
    expect:
      variables:
        result: 255

  - name: replicate_literal
    sv: |
      module Test;
        bit [31:0] result;
        initial begin
          result = {4{8'hCD}};
        end
      endmodule
    expect:
      variables:
        result: "32'hCDCDCDCD"

  - name: replicate_twice
    sv: |
      module Test;
        bit [7:0] x;
        bit [15:0] result;
        initial begin
          x = 8'h5A;
          result = {2{x}};
        end
      endmodule
    expect:
      variables:
        result: "16'h5A5A"

  - name: replicate_in_concatenation
    description: Replication inside a concatenation
    sv: |
      module Test;
        byte a, b;
        bit [39:0] result;
        initial begin
          a = 8'hAA;
          b = 8'hBB;
          result = {a, {3{b}}, a};
        end
      endmodule
    expect:
      variables:
        result: "40'hAABBBBBBAA"

  - name: replicate_nested_concat
    description: Replication of a concatenation
    sv: |
      module Test;
        bit [3:0] a, b;
        bit [15:0] result;
        initial begin
          a = 4'hA;
          b = 4'hB;
          result = {2{a, b}};
        end
      endmodule
    expect:
      variables:
        result: "16'hABAB"

  - name: replicate_multiple_in_concat
    description: Multiple replications in same concatenation
    sv: |
      module Test;
        byte x;
        bit [63:0] result;
        longint lo;
        initial begin
          x = 8'hAB;
          result = {x, {3{x}}, {4{x}}};
          lo = result;
        end
      endmodule
    expect:
      variables:
        lo: -6076574518398440533 # 0xABABABABABABABAB

  - name: replicate_wide_result
    description: Replication resulting in wide (>64 bit) value
    sv: |
      module Test;
        bit [15:0] x;
        bit [79:0] result;
        longint lo;
        initial begin
          x = 16'hDEAD;
          result = {5{x}};
          lo = result[63:0];
        end
      endmodule
    expect:
      variables:
        lo: -2401018187971961171 # 0xDEADDEADDEADDEAD

  - name: replicate_signed_operand
    description: Signed operand contributes raw bits
    sv: |
      module Test;
        byte x;
        bit [31:0] result;
        initial begin
          x = -1;  // 0xFF in raw bits
          result = {4{x}};
        end
      endmodule
    expect:
      variables:
        result: "32'hFFFFFFFF"

  - name: replicate_once
    description: Replication with count 1 (identity)
    sv: |
      module Test;
        byte x;
        bit [7:0] result;
        initial begin
          x = 8'h42;
          result = {1{x}};
        end
      endmodule
    expect:
      variables:
        result: "8'h42"

  - name: replicate_zero_in_concat
    description: Zero replication inside concatenation (LRM allows this)
    sv: |
      module Test;
        bit [15:0] result;
        initial begin
          result = {8'hAB, {0{8'hFF}}, 8'hCD};
        end
      endmodule
    expect:
      variables:
        result: "16'hABCD"

  - name: replicate_nested
    description: Nested replication (replication of replication)
    sv: |
      module Test;
        bit [23:0] result;
        initial begin
          result = {2{{3{4'hA}}}};  // 2 * 3 = 6 nibbles = 24 bits
        end
      endmodule
    expect:
      variables:
        result: "24'hAAAAAA"
