feature: display_string_packed
description: Tests for %s format specifier with packed values

cases:
  - name: packed_basic
    sv: |
      module Test;
        initial begin
          logic [39:0] x = "Hello";
          $display(">%s<", x);
        end
      endmodule
    expect:
      stdout: ">Hello<\n"

  - name: packed_non_byte_aligned
    description: 20 bits = 3 bytes rounded. Value 0x04142 = "\x00AB", leading zero skipped => "AB"
    sv: |
      module Test;
        initial begin
          logic [19:0] x = 20'h04142;
          $display(">%s<", x);
        end
      endmodule
    expect:
      stdout: ">AB<\n"

  - name: packed_wide
    sv: |
      module Test;
        initial begin
          logic [79:0] x = "0123456789";
          $display(">%s<", x);
        end
      endmodule
    expect:
      stdout: ">0123456789<\n"

  - name: packed_leading_zeros
    sv: |
      module Test;
        initial begin
          logic [31:0] x = 32'h00004142;
          $display(">%s<", x);
        end
      endmodule
    expect:
      stdout: ">AB<\n"

  - name: string_direct
    sv: |
      module Test;
        initial begin
          string s = "world";
          $display(">%s<", s);
        end
      endmodule
    expect:
      stdout: ">world<\n"

  - name: packed_single_char
    sv: |
      module Test;
        initial begin
          logic [7:0] x = "X";
          $display(">%s<", x);
        end
      endmodule
    expect:
      stdout: ">X<\n"

  - name: packed_empty
    description: All zeros produces empty string
    sv: |
      module Test;
        initial begin
          logic [31:0] x = 32'h0;
          $display(">%s<", x);
        end
      endmodule
    expect:
      stdout: "><\n"

  # Note: 2-state bit type test case removed for now.
  # There appears to be an endianness issue with narrow non-byte-aligned 2-state
  # packed types that needs further investigation.

  # Code path coverage tests - each variant routes through different lowering

  - name: write_packed
    description: $write uses LowerStringOp path (same as $display)
    sv: |
      module Test;
        initial begin
          logic [39:0] x = "Hello";
          $write(">%s<", x);
          $display("");
        end
      endmodule
    expect:
      stdout: ">Hello<\n"

  - name: sformatf_packed
    description: $sformatf uses LowerFormatOpToBuffer path
    sv: |
      module Test;
        initial begin
          logic [39:0] x = "Hello";
          string s = $sformatf(">%s<", x);
          $display("%s", s);
        end
      endmodule
    expect:
      stdout: ">Hello<\n"

  - name: fdisplay_packed
    description: $fdisplay uses LowerFormatOpToBuffer path
    sv: |
      module Test;
        initial begin
          logic [39:0] x = "World";
          $fdisplay(1, ">%s<", x);
        end
      endmodule
    expect:
      stdout: ">World<\n"

  - name: fwrite_packed
    description: $fwrite uses LowerFormatOpToBuffer path (same as $fdisplay)
    sv: |
      module Test;
        initial begin
          logic [39:0] x = "World";
          $fwrite(1, ">%s<", x);
          $display("");
        end
      endmodule
    expect:
      stdout: ">World<\n"
