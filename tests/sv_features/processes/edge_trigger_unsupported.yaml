feature: edge trigger rejection on unsupported sub-expressions
description: >
  Edge triggers (@posedge/@negedge) support plain signal variables and
  constant bit-selects on packed types. Other sub-expressions (struct fields,
  unpacked array elements, part-selects, dynamic bit-selects) are rejected
  at compile time.

cases:
  - name: posedge_struct_field
    description: "@(posedge s.x) should be rejected -- struct field member access"
    sv: |
      module Test;
        typedef struct packed { logic x; logic y; } pair_t;
        pair_t s;
        initial begin
          @(posedge s.x);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "edge triggers (@posedge/@negedge) are only supported on plain signal variables or constant bit-selects"

  - name: negedge_unpacked_array_element
    description: "@(negedge arr[0]) on unpacked array should be rejected"
    sv: |
      module Test;
        logic [7:0] arr [0:3];
        initial begin
          @(negedge arr[0]);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "edge triggers on unpacked array elements are not supported"

  - name: posedge_part_select
    description: "@(posedge bus[3:0]) should be rejected -- part-select is not supported"
    sv: |
      module Test;
        logic [7:0] bus;
        initial begin
          @(posedge bus[3:0]);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "edge triggers (@posedge/@negedge) are only supported on plain signal variables or constant bit-selects"

  - name: compound_edge_struct_field
    description: "@(posedge clk or negedge s.x) should be rejected -- s.x is not supported"
    sv: |
      module Test;
        typedef struct packed { logic x; logic y; } pair_t;
        bit clk = 0;
        pair_t s;
        initial begin
          @(posedge clk or negedge s.x);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "edge triggers (@posedge/@negedge) are only supported on plain signal variables or constant bit-selects"

  - name: dynamic_bit_select_edge
    description: "@(posedge bus[i]) with variable index should be rejected"
    sv: |
      module Test;
        logic [7:0] bus;
        int i = 3;
        initial begin
          @(posedge bus[i]);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "dynamic bit-select edge triggers are not supported"

  - name: out_of_range_bit_select_edge
    description: "@(posedge bus[100]) on 8-bit value should be rejected"
    sv: |
      module Test;
        logic [7:0] bus;
        initial begin
          @(posedge bus[100]);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "edge trigger bit-select index is out of range"

  - name: multi_bit_packed_element_select_edge
    description: "@(posedge bus[1]) on packed array with multi-bit elements should be rejected"
    sv: |
      module Test;
        logic [1:0][7:0] bus;
        initial begin
          @(posedge bus[1]);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "edge triggers on multi-bit packed element selects are not supported"

  - name: posedge_plain_signal
    description: "@(posedge clk) on a plain scalar signal should work (positive control)"
    sv: |
      module Test;
        bit clk = 0;
        int result = 0;
        initial begin
          @(posedge clk);
          result = 42;
          $finish;
        end
        initial #5 clk = 1;
      endmodule
    expect:
      variables:
        result: 42

  - name: level_sensitive_struct_field
    description: "@(s) with no edge (kAnyChange) should still work -- level-sensitive is fine"
    sv: |
      module Test;
        typedef struct packed { logic x; logic y; } pair_t;
        pair_t s;
        int result = 0;
        initial begin
          @(s);
          result = 1;
          $finish;
        end
        initial #5 s = '{1, 0};
      endmodule
    expect:
      variables:
        result: 1
