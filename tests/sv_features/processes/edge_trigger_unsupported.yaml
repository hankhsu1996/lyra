feature: edge trigger rejection on unsupported sub-expressions
description: >
  Edge triggers (@posedge/@negedge) support plain signal variables, constant
  bit/element-selects on packed types, packed struct fields, single-bit unpacked
  struct fields, constant-index unpacked array elements (single-bit), and
  constant range/part-selects on packed types. Other sub-expressions are
  rejected at compile time.

cases:
  - name: posedge_multibit_unpacked_struct_field
    description: "@(posedge s.data) on multi-bit unpacked struct field should be rejected"
    sv: |
      module Test;
        typedef struct { logic [7:0] data; logic flag; } pair_t;
        pair_t s;
        initial begin
          @(posedge s.data);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "edge triggers on multi-bit unpacked struct fields are not supported"

  - name: negedge_multibit_unpacked_array_element
    description: "@(negedge arr[0]) on multi-bit unpacked array element should be rejected"
    sv: |
      module Test;
        logic [7:0] arr [0:3];
        initial begin
          @(negedge arr[0]);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "edge triggers on multi-bit unpacked array elements are not supported"

  - name: dynamic_unpacked_array_edge
    description: "@(posedge arr[i]) with dynamic index on unpacked array should be rejected"
    sv: |
      module Test;
        logic arr [0:3];
        int i = 0;
        initial begin
          @(posedge arr[i]);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "dynamic unpacked array index edge triggers are not supported"

  - name: out_of_range_unpacked_array_edge
    description: "@(posedge arr[99]) out-of-range constant on unpacked array should be rejected"
    sv: |
      module Test;
        logic arr [0:3];
        initial begin
          @(posedge arr[99]);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "edge trigger array index is out of range"

  - name: dynamic_array_element_edge
    description: "@(posedge d[0]) on dynamic array element should be rejected"
    sv: |
      module Test;
        logic d[];
        initial begin
          @(posedge d[0]);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "edge triggers on dynamic array/queue elements are not supported"

  - name: dynamic_bit_select_edge
    description: "@(posedge bus[i]) with variable index should be rejected"
    sv: |
      module Test;
        logic [7:0] bus;
        int i = 3;
        initial begin
          @(posedge bus[i]);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "dynamic bit-select edge triggers are not supported"

  - name: out_of_range_bit_select_edge
    description: "@(posedge bus[100]) on 8-bit value should be rejected"
    sv: |
      module Test;
        logic [7:0] bus;
        initial begin
          @(posedge bus[100]);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "edge trigger bit-select index is out of range"

  - name: out_of_range_range_select_edge
    description: "@(posedge bus[9:9]) on 8-bit value should be rejected"
    sv: |
      module Test;
        logic [7:0] bus;
        initial begin
          @(posedge bus[9:9]);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "edge trigger range-select index is out of range"

  - name: dynamic_indexed_part_select_edge
    description: "@(posedge bus[i +: 1]) with variable index should be rejected"
    sv: |
      module Test;
        logic [7:0] bus;
        int i = 3;
        initial begin
          @(posedge bus[i +: 1]);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "dynamic indexed part-select edge triggers are not supported"

  - name: out_of_range_descending_part_select_lsb
    description: "@(posedge bus[1 -: 4]) rejected -- LSB (1-3=-2) is out of range"
    sv: |
      module Test;
        logic [7:0] bus;
        initial begin
          @(posedge bus[1 -: 4]);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "edge trigger part-select LSB is out of range"

  - name: posedge_plain_signal
    description: "@(posedge clk) on a plain scalar signal should work (positive control)"
    sv: |
      module Test;
        bit clk = 0;
        int result = 0;
        initial begin
          @(posedge clk);
          result = 42;
          $finish;
        end
        initial #5 clk = 1;
      endmodule
    expect:
      variables:
        result: 42

  - name: level_sensitive_struct_field
    description: "@(s) with no edge (kAnyChange) should still work -- level-sensitive is fine"
    sv: |
      module Test;
        typedef struct packed { logic x; logic y; } pair_t;
        pair_t s;
        int result = 0;
        initial begin
          @(s);
          result = 1;
          $finish;
        end
        initial #5 s = '{1, 0};
      endmodule
    expect:
      variables:
        result: 1
