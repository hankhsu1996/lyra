feature: foreach_2d_llvm
description: 2D foreach tests including signed comparisons on projected places

cases:
  - name: foreach_2d_signed_compare_constant
    description: Signed compare on arr[i][j] vs constant (regression for GetOperandPackedWidth)
    sv: |
      module Test;
        int sum;
        initial begin
          int arr[3][3];
          arr[0][0] = 1; arr[0][1] = 2; arr[0][2] = 3;
          arr[1][0] = 4; arr[1][1] = 5; arr[1][2] = 6;
          arr[2][0] = 7; arr[2][1] = 8; arr[2][2] = 9;
          sum = 0;
          foreach (arr[i,j]) begin
            if (arr[i][j] > 5) break;
            sum = sum + arr[i][j];
          end
        end
      endmodule
    expect:
      variables:
        sum: 15

  - name: foreach_2d_signed_compare_two_elements
    description: Signed compare between two projected array elements
    sv: |
      module Test;
        int count;
        initial begin
          int arr[2][3];
          arr[0][0] = 10; arr[0][1] = 20; arr[0][2] = 30;
          arr[1][0] = 5;  arr[1][1] = 25; arr[1][2] = 15;
          count = 0;
          foreach (arr[i,j]) begin
            if (arr[0][j] <= arr[1][j]) begin
              count = count + 1;
            end
          end
        end
      endmodule
    expect:
      variables:
        count: 2

  - name: foreach_2d_signed_compare_negative
    description: Signed compare with negative values on projected place
    sv: |
      module Test;
        int neg_count;
        initial begin
          int arr[2][3];
          arr[0][0] = -5; arr[0][1] = 3; arr[0][2] = -1;
          arr[1][0] = 2;  arr[1][1] = -4; arr[1][2] = 0;
          neg_count = 0;
          foreach (arr[i,j]) begin
            if (arr[i][j] < 0) begin
              neg_count = neg_count + 1;
            end
          end
        end
      endmodule
    expect:
      variables:
        neg_count: 3

  - name: foreach_2d_with_for_init_and_break
    description: 2D foreach with for-loop initialization and break on element value
    sv: |
      module Test;
        int sum;
        int stopped_i, stopped_j;
        initial begin
          int arr[3][3];
          int val;
          val = 1;
          for (int r = 0; r < 3; r++)
            for (int c = 0; c < 3; c++) begin
              arr[r][c] = val;
              val = val + 1;
            end
          sum = 0;
          stopped_i = -1;
          stopped_j = -1;
          foreach (arr[i,j]) begin
            if (arr[i][j] > 5) break;
            sum = sum + arr[i][j];
            stopped_i = i;
            stopped_j = j;
          end
        end
      endmodule
    expect:
      variables:
        sum: 15
        stopped_i: 1
        stopped_j: 1

  - name: foreach_2d_with_continue_on_compare
    description: Continue based on signed compare of projected element
    sv: |
      module Test;
        int sum;
        initial begin
          int arr[2][3];
          arr[0][0] = 1; arr[0][1] = 2; arr[0][2] = 3;
          arr[1][0] = 4; arr[1][1] = 5; arr[1][2] = 6;
          sum = 0;
          foreach (arr[i,j]) begin
            if (arr[i][j] >= 4) continue;
            sum = sum + arr[i][j];
          end
        end
      endmodule
    expect:
      variables:
        sum: 6
