feature: edge trigger rejection on non-root expressions
description: >
  Edge triggers (@posedge/@negedge) only support plain signal variables.
  Sub-expressions (struct fields, array elements, part-selects) are rejected
  at compile time because the runtime samples bit 0 of the slot root.

cases:
  - name: posedge_struct_field
    description: "@(posedge s.x) should be rejected -- struct field is not a root variable"
    sv: |
      module Test;
        typedef struct packed { logic x; logic y; } pair_t;
        pair_t s;
        initial begin
          @(posedge s.x);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "edge triggers (@posedge/@negedge) are only supported on plain signal variables"

  - name: negedge_array_element
    description: "@(negedge arr[0]) should be rejected -- array element is not a root variable"
    sv: |
      module Test;
        logic [7:0] arr [0:3];
        initial begin
          @(negedge arr[0]);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "edge triggers (@posedge/@negedge) are only supported on plain signal variables"

  - name: posedge_part_select
    description: "@(posedge bus[3:0]) should be rejected -- part-select is not a root variable"
    sv: |
      module Test;
        logic [7:0] bus;
        initial begin
          @(posedge bus[3:0]);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "edge triggers (@posedge/@negedge) are only supported on plain signal variables"

  - name: compound_edge_struct_field
    description: "@(posedge clk or negedge s.x) should be rejected -- s.x is not a root variable"
    sv: |
      module Test;
        typedef struct packed { logic x; logic y; } pair_t;
        bit clk = 0;
        pair_t s;
        initial begin
          @(posedge clk or negedge s.x);
          $finish;
        end
      endmodule
    expect:
      error:
        contains:
          - "edge triggers (@posedge/@negedge) are only supported on plain signal variables"

  - name: posedge_plain_signal
    description: "@(posedge clk) on a plain scalar signal should work (positive control)"
    sv: |
      module Test;
        bit clk = 0;
        int result = 0;
        initial begin
          @(posedge clk);
          result = 42;
          $finish;
        end
        initial #5 clk = 1;
      endmodule
    expect:
      variables:
        result: 42

  - name: level_sensitive_struct_field
    description: "@(s) with no edge (kAnyChange) should still work -- level-sensitive is fine"
    sv: |
      module Test;
        typedef struct packed { logic x; logic y; } pair_t;
        pair_t s;
        int result = 0;
        initial begin
          @(s);
          result = 1;
          $finish;
        end
        initial #5 s = '{1, 0};
      endmodule
    expect:
      variables:
        result: 1
