feature: functions_nested_calls
description: Tests for functions calling other functions

cases:
  - name: function_calls_function
    sv: |
      module Test;
        int result;

        function int inner(int x);
          return x * 2;
        endfunction

        function int outer(int x);
          return inner(x) + 10;
        endfunction

        initial begin
          result = outer(5);
        end
      endmodule
    expect:
      variables:
        result: 20

  - name: function_call_chain
    sv: |
      module Test;
        int result;

        function int add_one(int x);
          return x + 1;
        endfunction

        function int double_it(int x);
          return x * 2;
        endfunction

        function int process(int x);
          return double_it(add_one(x));
        endfunction

        initial begin
          result = process(10);
        end
      endmodule
    expect:
      variables:
        result: 22

  - name: function_result_as_argument
    sv: |
      module Test;
        int result;

        function int square(int x);
          return x * x;
        endfunction

        function int add(int a, int b);
          return a + b;
        endfunction

        initial begin
          result = add(square(3), square(4));
        end
      endmodule
    expect:
      variables:
        result: 25

  - name: deeply_nested_calls
    sv: |
      module Test;
        int result;

        function int f1(int x);
          return x + 1;
        endfunction

        function int f2(int x);
          return f1(x) * 2;
        endfunction

        function int f3(int x);
          return f2(x) + 3;
        endfunction

        function int f4(int x);
          return f3(x) * 4;
        endfunction

        initial begin
          result = f4(5);
        end
      endmodule
    expect:
      variables:
        result: 60

  - name: multiple_function_calls_in_expression
    sv: |
      module Test;
        int result;

        function int a(int x);
          return x + 1;
        endfunction

        function int b(int x);
          return x * 2;
        endfunction

        function int c(int x);
          return x - 3;
        endfunction

        initial begin
          // a(10)=11, b(5)=10, c(20)=17, total=38
          result = a(10) + b(5) + c(20);
        end
      endmodule
    expect:
      variables:
        result: 38

  - name: function_call_in_conditional
    sv: |
      module Test;
        int result;

        function int is_positive(int x);
          if (x > 0)
            return 1;
          return 0;
        endfunction

        function int process(int x);
          if (is_positive(x))
            return x * 2;
          else
            return x * -1;
        endfunction

        initial begin
          result = process(5) + process(-3);
        end
      endmodule
    expect:
      variables:
        result: 13

  - name: function_call_in_loop
    sv: |
      module Test;
        int result;

        function int double_it(int x);
          return x * 2;
        endfunction

        initial begin
          result = 1;
          for (int i = 0; i < 3; i = i + 1) begin
            result = double_it(result);
          end
        end
      endmodule
    expect:
      variables:
        result: 8

  - name: void_function_calls_function
    sv: |
      module Test;
        int counter;

        function int get_increment();
          return 5;
        endfunction

        function void add_increment();
          counter = counter + get_increment();
        endfunction

        initial begin
          counter = 10;
          add_increment();
          add_increment();
        end
      endmodule
    expect:
      variables:
        counter: 20
