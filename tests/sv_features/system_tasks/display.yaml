feature: display
description: Tests for $display system task output

cases:
  - name: display_string
    sv: |
      module Test;
        initial $display("Hello World");
      endmodule
    expect:
      stdout: "Hello World\n"

  - name: display_empty
    sv: |
      module Test;
        initial $display();
      endmodule
    expect:
      stdout: "\n"

  - name: display_integer
    sv: |
      module Test;
        int x;
        initial begin
          x = 42;
          $display("%d", x);
        end
      endmodule
    expect:
      stdout: "42\n"

  - name: display_multiple_values
    sv: |
      module Test;
        int a, b;
        initial begin
          a = 10;
          b = 20;
          $display("a=%d b=%d", a, b);
        end
      endmodule
    expect:
      stdout: "a=10 b=20\n"

  - name: display_hex_format
    sv: |
      module Test;
        int x;
        initial begin
          x = 255;
          $display("%h", x);
        end
      endmodule
    expect:
      stdout: "ff\n"

  - name: display_binary_format
    sv: |
      module Test;
        int x;
        initial begin
          x = 5;
          $display("%b", x);
        end
      endmodule
    expect:
      stdout: "101\n"

  - name: display_multiple_calls
    sv: |
      module Test;
        initial begin
          $display("line 1");
          $display("line 2");
        end
      endmodule
    expect:
      stdout: |
        line 1
        line 2

  - name: display_no_format_string
    sv: |
      module Test;
        int x;
        initial begin
          x = 99;
          $display(x);
        end
      endmodule
    expect:
      stdout: "99\n"

  - name: display_contains_check
    sv: |
      module Test;
        initial begin
          $display("prefix data suffix");
          $display("more output");
        end
      endmodule
    expect:
      stdout:
        contains:
          - "data"
          - "more"

  - name: display_real_default_precision
    sv: |
      module Test;
        real x;
        initial begin
          x = 1.5;
          $display("%f", x);
        end
      endmodule
    expect:
      stdout: "1.500000\n"

  - name: display_real_with_precision
    sv: |
      module Test;
        real x;
        initial begin
          x = 3.14159;
          $display("%.3f", x);
        end
      endmodule
    expect:
      stdout: "3.142\n"

  - name: display_integer_width
    sv: |
      module Test;
        int x;
        initial begin
          x = 42;
          $display("%5d", x);
        end
      endmodule
    expect:
      stdout: "   42\n"

  - name: display_integer_zero_pad
    sv: |
      module Test;
        int x;
        initial begin
          x = 42;
          $display("%05d", x);
        end
      endmodule
    expect:
      stdout: "00042\n"

  - name: display_hex_zero_pad
    sv: |
      module Test;
        int x;
        initial begin
          x = 255;
          $display("%04h", x);
        end
      endmodule
    expect:
      stdout: "00ff\n"

  - name: display_binary_zero_pad
    sv: |
      module Test;
        int x;
        initial begin
          x = 5;
          $display("%08b", x);
        end
      endmodule
    expect:
      stdout: "00000101\n"

  - name: display_string_width
    sv: |
      module Test;
        string s;
        initial begin
          s = "hi";
          $display("[%5s]", s);
        end
      endmodule
    expect:
      stdout: "[   hi]\n"

  - name: display_string_left_align
    sv: |
      module Test;
        string s;
        initial begin
          s = "hi";
          $display("[%-5s]", s);
        end
      endmodule
    expect:
      stdout: "[hi   ]\n"

  # $write variants (no newline)
  - name: write_no_newline
    sv: |
      module Test;
        initial begin
          $write("no");
          $write("newline");
        end
      endmodule
    expect:
      stdout: "nonewline"

  - name: write_empty_does_nothing
    sv: |
      module Test;
        initial begin
          $write();
          $write("done");
        end
      endmodule
    expect:
      stdout: "done"

  - name: writeh_default_hex
    sv: |
      module Test;
        int x;
        initial begin
          x = 255;
          $writeh(x);
        end
      endmodule
    expect:
      stdout: "ff"

  - name: writeb_default_binary
    sv: |
      module Test;
        int x;
        initial begin
          x = 5;
          $writeb(x);
        end
      endmodule
    expect:
      stdout: "101"

  - name: writeo_default_octal
    sv: |
      module Test;
        int x;
        initial begin
          x = 8;
          $writeo(x);
        end
      endmodule
    expect:
      stdout: "10"

  # $display variants (with newline, different default format)
  - name: displayh_default_hex
    sv: |
      module Test;
        int x;
        initial begin
          x = 255;
          $displayh(x);
        end
      endmodule
    expect:
      stdout: "ff\n"

  - name: displayb_default_binary
    sv: |
      module Test;
        int x;
        initial begin
          x = 5;
          $displayb(x);
        end
      endmodule
    expect:
      stdout: "101\n"

  - name: displayo_default_octal
    sv: |
      module Test;
        int x;
        initial begin
          x = 8;
          $displayo(x);
        end
      endmodule
    expect:
      stdout: "10\n"

  # Format string overrides default
  - name: displayh_with_format_uses_format
    sv: |
      module Test;
        int x;
        initial begin
          x = 255;
          $displayh("%d", x);
        end
      endmodule
    expect:
      stdout: "255\n"

  - name: writeb_with_format_uses_format
    sv: |
      module Test;
        int x;
        initial begin
          x = 255;
          $writeb("%h", x);
        end
      endmodule
    expect:
      stdout: "ff"

  # Multiple values with variant default
  - name: displayh_multiple_values
    sv: |
      module Test;
        int a, b;
        initial begin
          a = 10;
          b = 255;
          $displayh(a, b);
        end
      endmodule
    expect:
      stdout: "aff\n"

  # Mixed types - integers use variant format, others use default
  - name: displayh_mixed_types
    sv: |
      module Test;
        int x;
        string s;
        initial begin
          x = 255;
          s = "test";
          $displayh(x, s);
        end
      endmodule
    expect:
      stdout: "fftest\n"

  # Wide bit vectors (>64 bits) with decimal format
  # Note: Codegen has a limitation with very large literal values (>64 bits),
  # so we test with values that fit in 64 bits but are stored in wide types.

  - name: wide_decimal_128bit
    sv: |
      module Test;
        logic [127:0] val;
        initial begin
          val = 128'd12345678901234567890;
          $display("%d", val);
        end
      endmodule
    expect:
      stdout: "12345678901234567890\n"

  - name: wide_decimal_zero
    sv: |
      module Test;
        logic [127:0] val;
        initial begin
          val = 128'd0;
          $display("%d", val);
        end
      endmodule
    expect:
      stdout: "0\n"

  - name: wide_decimal_no_format_string
    sv: |
      module Test;
        logic [127:0] val;
        initial begin
          val = 128'd999999999999999999;
          $display(val);
        end
      endmodule
    expect:
      stdout: "999999999999999999\n"

  - name: wide_decimal_computed
    sv: |
      module Test;
        logic [127:0] val;
        logic [127:0] a, b;
        initial begin
          a = 128'd9000000000000000000;
          b = 128'd1234567890123456789;
          val = a + b;  // Computed value spans >64 bits
          $display("%d", val);
        end
      endmodule
    expect:
      stdout: "10234567890123456789\n"
