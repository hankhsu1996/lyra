feature: case_statements
description: Tests for case statements (case, casez, casex - no case inside)

cases:
  - name: case_basic_match
    sv: |
      module Test;
        int x;
        int result;
        initial begin
          x = 2;
          result = 0;
          case (x)
            1: result = 10;
            2: result = 20;
            3: result = 30;
          endcase
        end
      endmodule
    expect:
      variables:
        result: 20

  - name: case_no_match_no_default
    sv: |
      module Test;
        int x;
        int result;
        initial begin
          x = 5;
          result = 100;
          case (x)
            1: result = 10;
            2: result = 20;
            3: result = 30;
          endcase
        end
      endmodule
    expect:
      variables:
        result: 100

  - name: case_default
    sv: |
      module Test;
        int x;
        int result;
        initial begin
          x = 5;
          result = 0;
          case (x)
            1: result = 10;
            2: result = 20;
            default: result = 99;
          endcase
        end
      endmodule
    expect:
      variables:
        result: 99

  - name: case_multiple_values
    sv: |
      module Test;
        int x;
        int result;
        initial begin
          x = 3;
          result = 0;
          case (x)
            1, 2: result = 10;
            3, 4: result = 20;
            5, 6: result = 30;
          endcase
        end
      endmodule
    expect:
      variables:
        result: 20

  - name: case_first_match_wins
    sv: |
      module Test;
        int x;
        int result;
        initial begin
          x = 2;
          result = 0;
          case (x)
            2: result = 10;
            2: result = 20;
            2: result = 30;
          endcase
        end
      endmodule
    expect:
      variables:
        result: 10

  - name: case_variable_condition
    sv: |
      module Test;
        int selector;
        int a, b, c;
        int result;
        initial begin
          selector = 2;
          a = 10;
          b = 20;
          c = 30;
          result = 0;
          case (selector)
            1: result = a;
            2: result = b;
            3: result = c;
          endcase
        end
      endmodule
    expect:
      variables:
        result: 20

  - name: case_constant_expression
    sv: |
      module Test;
        int encode;
        int result;
        initial begin
          encode = 2;
          result = 0;
          case (1)
            encode == 1: result = 1;
            encode == 2: result = 2;
            encode == 3: result = 3;
            default: result = 99;
          endcase
        end
      endmodule
    expect:
      variables:
        result: 2

  - name: case_nested
    sv: |
      module Test;
        int x;
        int y;
        int result;
        initial begin
          x = 1;
          y = 2;
          result = 0;
          case (x)
            1: begin
              case (y)
                1: result = 11;
                2: result = 12;
                default: result = 19;
              endcase
            end
            2: begin
              case (y)
                1: result = 21;
                2: result = 22;
                default: result = 29;
              endcase
            end
            default: result = 99;
          endcase
        end
      endmodule
    expect:
      variables:
        result: 12

  # casez tests - ? and z are wildcards
  # Using int type since logic [3:0] is not yet supported
  - name: casez_basic_wildcard
    sv: |
      module Test;
        int x;
        int result;
        initial begin
          x = 10;  // 0b1010
          result = 0;
          casez (x)
            32'b1???????????????????????????????: result = 1;  // MSB is 0
            32'b0000000000000000000000000000????: result = 2;  // Match low 4 bits as 1xxx
            default: result = 99;
          endcase
        end
      endmodule
    expect:
      variables:
        result: 2

  - name: casez_simple
    sv: |
      module Test;
        int x;
        int result;
        initial begin
          x = 5;  // binary: 0101
          result = 0;
          casez (x)
            32'd5: result = 1;  // exact match
            32'd10: result = 2;
            default: result = 99;
          endcase
        end
      endmodule
    expect:
      variables:
        result: 1

  - name: casez_wildcard_match
    sv: |
      module Test;
        int x;
        int result;
        initial begin
          x = 7;  // binary: 0111
          result = 0;
          casez (x)
            32'b00000000000000000000000000000???: result = 1;  // matches 0-7
            32'b0000000000000000000000000000????: result = 2;  // matches 0-15
            default: result = 99;
          endcase
        end
      endmodule
    expect:
      variables:
        result: 1

  - name: casez_no_match
    sv: |
      module Test;
        int x;
        int result;
        initial begin
          x = 100;
          result = 0;
          casez (x)
            32'd1: result = 1;
            32'd2: result = 2;
            default: result = 99;
          endcase
        end
      endmodule
    expect:
      variables:
        result: 99

  - name: casez_first_match_wins
    sv: |
      module Test;
        int x;
        int result;
        initial begin
          x = 5;
          result = 0;
          casez (x)
            32'b00000000000000000000000000000???: result = 1;  // matches 0-7
            32'd5: result = 2;  // exact match for 5
            default: result = 99;
          endcase
        end
      endmodule
    expect:
      variables:
        result: 1

  # casex tests - ?, x, and z are wildcards
  - name: casex_basic
    sv: |
      module Test;
        int x;
        int result;
        initial begin
          x = 5;  // binary: 0101
          result = 0;
          casex (x)
            32'b00000000000000000000000000000xxx: result = 1;  // matches 0-7
            32'd10: result = 2;
            default: result = 99;
          endcase
        end
      endmodule
    expect:
      variables:
        result: 1

  - name: casez_nested
    sv: |
      module Test;
        int x;
        int y;
        int result;
        initial begin
          x = 5;  // binary: 0101
          y = 4;  // binary: 0100
          result = 0;
          casez (x)
            32'b00000000000000000000000000000???: begin
              // x matches 0-7 (low 3 bits wildcarded)
              casez (y)
                32'b00000000000000000000000000000100: result = 10;  // y = 4 exactly
                default: result = 19;
              endcase
            end
            default: result = 99;
          endcase
        end
      endmodule
    expect:
      variables:
        result: 10
