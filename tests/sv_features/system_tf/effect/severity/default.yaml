feature: severity
description: Tests for severity system tasks ($fatal, $error, $warning, $info)

cases:
  # $info tests - should continue simulation
  - name: info_basic
    sv: |
      module Test;
        int x;
        initial begin
          x = 1;
          $info("Info message");
          x = 2;  // Should execute
        end
      endmodule
    expect:
      variables:
        x: 2
      stdout:
        contains:
          - "info"
          - "Info message"

  # Golden test: auto-format uses decimal (not hex)
  - name: info_auto_decimal
    sv: |
      module Test;
        int x;
        initial begin
          x = 42;
          $info(x);  // Should output "info: 42" (decimal, not hex)
        end
      endmodule
    expect:
      variables:
        x: 42
      stdout:
        contains:
          - "info: "
          - "42"
        not_contains:
          - "2a"  # hex for 42

  # Golden test: explicit format string overrides default
  - name: info_explicit_hex
    sv: |
      module Test;
        int x;
        initial begin
          x = 255;
          $info("val=%0h", x);  // Should output "info: val=ff" (minimal width)
        end
      endmodule
    expect:
      variables:
        x: 255
      stdout:
        contains:
          - "info: "
          - "val=ff"

  - name: info_no_message
    sv: |
      module Test;
        int x;
        initial begin
          $info;
          x = 42;
        end
      endmodule
    expect:
      variables:
        x: 42
      stdout:
        contains:
          - "info"

  # $warning tests - should continue simulation
  - name: warning_basic
    sv: |
      module Test;
        int x;
        initial begin
          x = 1;
          $warning("Warning message");
          x = 2;  // Should execute
        end
      endmodule
    expect:
      variables:
        x: 2
      stdout:
        contains:
          - "warning"
          - "Warning message"

  - name: warning_with_format
    sv: |
      module Test;
        int x;
        initial begin
          x = 10;
          $warning("Value is %0d", x);
          x = 20;
        end
      endmodule
    expect:
      variables:
        x: 20
      stdout:
        contains:
          - "warning"
          - "Value is 10"

  # $error tests - should continue simulation (VCS style)
  - name: error_basic
    sv: |
      module Test;
        int x;
        initial begin
          x = 1;
          $error("Error message");
          x = 2;  // Should execute (non-terminating)
        end
      endmodule
    expect:
      variables:
        x: 2
      stdout:
        contains:
          - "error"
          - "Error message"

  - name: error_with_format
    sv: |
      module Test;
        int x;
        initial begin
          x = 5;
          $error("Invalid value: %0d", x);
          x = 6;
        end
      endmodule
    expect:
      variables:
        x: 6
      stdout:
        contains:
          - "error"
          - "Invalid value: 5"

  - name: error_no_message
    sv: |
      module Test;
        int x;
        initial begin
          $error;
          x = 99;
        end
      endmodule
    expect:
      variables:
        x: 99
      stdout:
        contains:
          - "error"

  # $fatal tests - should terminate simulation
  - name: fatal_basic
    sv: |
      module Test;
        int x;
        initial begin
          x = 1;
          $fatal(1, "Fatal error");
          x = 2;  // Should NOT execute
        end
      endmodule
    expect:
      variables:
        x: 1
      stdout:
        contains:
          - "fatal"
          - "Fatal error"

  - name: fatal_no_message
    sv: |
      module Test;
        int x;
        initial begin
          x = 10;
          $fatal(1);
        end
      endmodule
    expect:
      variables:
        x: 10
      stdout:
        contains:
          - "fatal"

  - name: fatal_level_0
    sv: |
      module Test;
        int x;
        initial begin
          x = 42;
          $fatal(0);  // Level 0: minimal output
        end
      endmodule
    expect:
      variables:
        x: 42

  - name: fatal_default_level
    sv: |
      module Test;
        int x;
        initial begin
          x = 7;
          $fatal;  // No args = level 1
        end
      endmodule
    expect:
      variables:
        x: 7
      stdout:
        contains:
          - "fatal"

  # $fatal with string as first arg (not level) - should treat as message
  - name: fatal_string_first_arg
    sv: |
      module Test;
        int x;
        initial begin
          x = 5;
          $fatal("Error: %0d", x);
        end
      endmodule
    expect:
      variables:
        x: 5
      stdout:
        contains:
          - "fatal"
          - "Error: 5"

  # $fatal output should be single line (no time line)
  - name: fatal_single_line_output
    sv: |
      module Test;
        int x;
        initial begin
          x = 1;
          $fatal(1, "Single line");
        end
      endmodule
    expect:
      variables:
        x: 1
      stdout:
        contains:
          - "fatal"
          - "Single line"
        not_contains:
          - "called at time"

  # Multiple severity calls
  - name: multiple_severities
    sv: |
      module Test;
        int x;
        initial begin
          x = 0;
          $info("First");
          x = 1;
          $warning("Second");
          x = 2;
          $error("Third");
          x = 3;
        end
      endmodule
    expect:
      variables:
        x: 3
      stdout:
        contains:
          - "info"
          - "First"
          - "warning"
          - "Second"
          - "error"
          - "Third"
