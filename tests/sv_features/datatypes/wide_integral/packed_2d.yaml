feature: wide_packed_arrays_2d
description: 2D packed arrays where total width exceeds 64 bits

cases:
  - name: wide_2d_element_write_and_read
    sv: |
      module Test;
        bit [1:0][127:0] data;
        initial begin
          data[0] = 128'd100;
          data[1] = 128'd200;
        end
      endmodule
    expect:
      variables:
        data: 0xc800000000000000000000000000000064

  - name: wide_2d_element_arithmetic
    sv: |
      module Test;
        bit [1:0][127:0] a, b, c;
        initial begin
          a[0] = 128'd1000;
          a[1] = 128'd2000;
          b[0] = 128'd300;
          b[1] = 128'd400;
          c[0] = a[0] + b[0];
          c[1] = a[1] + b[1];
        end
      endmodule
    expect:
      variables:
        c: 0x96000000000000000000000000000000514

  - name: wide_2d_element_overwrite
    sv: |
      module Test;
        bit [1:0][127:0] data;
        initial begin
          data[0] = 128'd100;
          data[1] = 128'd200;
          data[0] = 128'd999;
        end
      endmodule
    expect:
      variables:
        data: 0xc8000000000000000000000000000003e7

  - name: wide_2d_variable_index_read
    sv: |
      module Test;
        bit [1:0][127:0] data;
        bit [127:0] elem;
        int idx;
        initial begin
          data[0] = 128'd42;
          data[1] = 128'd84;
          idx = 1;
          elem = data[idx];
        end
      endmodule
    expect:
      variables:
        elem: 0x54

  - name: wide_2d_variable_index_write
    sv: |
      module Test;
        bit [1:0][127:0] data;
        int idx;
        initial begin
          idx = 0;
          data[idx] = 128'd111;
          idx = 1;
          data[idx] = 128'd222;
        end
      endmodule
    expect:
      variables:
        data: 0xde0000000000000000000000000000006f

  - name: wide_2d_65bit_boundary
    sv: |
      module Test;
        bit [1:0][64:0] data;
        initial begin
          data[0] = 65'd12345678901234;
          data[1] = 65'd98765432109876;
        end
      endmodule
    expect:
      variables:
        data: 0xb3a73cfe766800000b3a73ce2ff2

  - name: wide_2d_65bit_variable_index
    sv: |
      module Test;
        bit [1:0][64:0] data;
        bit [64:0] elem;
        int idx;
        initial begin
          data[0] = 65'd42;
          data[1] = 65'd84;
          idx = 0;
          elem = data[idx];
        end
      endmodule
    expect:
      variables:
        elem: 0x2a

  - name: wide_2d_whole_array_assignment
    sv: |
      module Test;
        bit [1:0][127:0] a, b;
        int match;
        initial begin
          a[0] = 128'd1234567890;
          a[1] = 128'd9876543210;
          b = a;
          match = (b == a) ? 1 : 0;
        end
      endmodule
    expect:
      variables:
        match: 1

  - name: descending_dimension_read
    description: Descending [1:0] has element 0 at LSB
    sv: |
      module Test;
        bit [1:0][7:0] data;
        bit [15:0] e0, e1;
        initial begin
          data = 16'hABCD;
          e0 = data[0];
          e1 = data[1];
        end
      endmodule
    expect:
      variables:
        e0: 0xCD
        e1: 0xAB

  - name: ascending_dimension_read
    description: Ascending [0:1] has element 0 at MSB
    sv: |
      module Test;
        bit [0:1][7:0] data;
        bit [15:0] e0, e1;
        initial begin
          data = 16'hABCD;
          e0 = data[0];
          e1 = data[1];
        end
      endmodule
    expect:
      variables:
        e0: 0xAB
        e1: 0xCD

  - name: ascending_nonzero_lower_bound
    description: Ascending [1:2] with nonzero lower bound
    sv: |
      module Test;
        bit [1:2][7:0] data;
        bit [15:0] e1, e2;
        initial begin
          data = 16'hABCD;
          e1 = data[1];
          e2 = data[2];
        end
      endmodule
    expect:
      variables:
        e1: 0xAB
        e2: 0xCD

  - name: descending_lvalue_preserves_other
    description: Lvalue write preserves other elements (descending)
    sv: |
      module Test;
        bit [1:0][7:0] data;
        bit [15:0] e1_after;
        bit [31:0] data_after;
        initial begin
          data = 16'hABCD;
          data[0] = 8'h00;
          e1_after = data[1];
          data_after = data;
        end
      endmodule
    expect:
      variables:
        e1_after: 0xAB
        data_after: 0xAB00

  - name: ascending_lvalue_preserves_other
    description: Lvalue write preserves other elements (ascending)
    sv: |
      module Test;
        bit [0:1][7:0] data;
        bit [15:0] e1_after;
        bit [15:0] data_after;
        initial begin
          data = 16'hABCD;
          data[0] = 8'h00;
          e1_after = data[1];
          data_after = data;
        end
      endmodule
    expect:
      variables:
        e1_after: 0xCD
        data_after: 0x00CD

  - name: ascending_negative_lower_bound
    description: Ascending [-1:0] with negative lower bound
    sv: |
      module Test;
        bit [-1:0][7:0] data;
        bit [15:0] e_neg1, e_0;
        initial begin
          data = 16'hABCD;
          e_neg1 = data[-1];
          e_0 = data[0];
        end
      endmodule
    expect:
      variables:
        e_neg1: 0xAB
        e_0: 0xCD

  - name: ascending_wide_element_boundary
    description: Ascending with 65-bit elements crossing word boundary
    sv: |
      module Test;
        bit [0:1][64:0] data;
        bit [64:0] e0, e1;
        initial begin
          data[0] = 65'd12345678901234;
          data[1] = 65'd98765432109876;
          e0 = data[0];
          e1 = data[1];
        end
      endmodule
    expect:
      variables:
        e0: 0xb3a73ce2ff2
        e1: 0x59d39e7f3b34
