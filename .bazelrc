build --action_env=CC=clang
build --action_env=CXX=clang++
build --cxxopt='-std=c++23'
build --cxxopt='-Wall'
build --cxxopt='-Wextra'
build --cxxopt='-Wno-unused-parameter'

# LLVM 17 doesn't build with C++23 (constexpr unique_ptr requires complete types)
build --per_file_copt=external/llvm-project.*.cpp@-std=c++17
build --incompatible_strict_action_env
build --disk_cache=~/.cache/bazel-disk

# BuildBuddy remote cache (always on for all builds)
build --bes_results_url=https://app.buildbuddy.io/invocation/
build --bes_backend=grpcs://remote.buildbuddy.io
common --remote_cache=grpcs://remote.buildbuddy.io
common --noremote_upload_local_results
common --remote_timeout=10m

# Auth: import from ~/.bazelrc (local) or CI sets --remote_header directly
try-import %workspace%/.bazelrc.user

# CI config: enable cache writes (trusted builds only)
build:ci --remote_upload_local_results=true

build --local_resources=cpu=HOST_CPUS*0.7
build --verbose_failures

# Debug build configuration
build:debug --compilation_mode=dbg
build:debug --cxxopt='-Wall'
build:debug --cxxopt='-Wextra'
build:debug --cxxopt='-Wno-unused-parameter'
build:debug --cxxopt='-Wno-deprecated-declarations'

# Release build configuration
build:release --compilation_mode=opt
build:release --cxxopt='-O3'
build:release --cxxopt='-DNDEBUG'

# Fastbuild configuration
build:fastbuild --compilation_mode=fastbuild
build:fastbuild --cxxopt='-O1'

# Test configuration
test --test_output=errors
