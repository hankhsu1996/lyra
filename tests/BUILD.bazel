load("@rules_cc//cc:defs.bzl", "cc_library", "cc_test")
load("//tests:sv_feature_test.bzl", "sv_feature_test")

cc_library(
    name = "test_framework",
    srcs = ["framework/yaml_loader.cpp"],
    hdrs = [
        "framework/test_case.hpp",
        "framework/yaml_loader.hpp",
    ],
    deps = [
        "@yaml-cpp",
    ],
)

# CLI test framework
cc_library(
    name = "cli_test_fixture",
    srcs = ["cli/cli_test_fixture.cpp"],
    hdrs = ["cli/cli_test_fixture.hpp"],
    deps = [
        "@googletest//:gtest",
    ],
)

cc_test(
    name = "cli_init_tests",
    srcs = ["cli/init_tests.cpp"],
    data = ["//:lyra"],
    env = {"TEST_WORKSPACE": "lyra"},
    deps = [
        ":cli_test_fixture",
        "@googletest//:gtest_main",
    ],
)

cc_test(
    name = "cli_config_tests",
    srcs = ["cli/config_tests.cpp"],
    data = ["//:lyra"],
    env = {"TEST_WORKSPACE": "lyra"},
    deps = [
        ":cli_test_fixture",
        "@googletest//:gtest_main",
    ],
)

cc_test(
    name = "cli_dump_tests",
    srcs = ["cli/dump_tests.cpp"],
    data = ["//:lyra"],
    env = {"TEST_WORKSPACE": "lyra"},
    deps = [
        ":cli_test_fixture",
        "@googletest//:gtest_main",
    ],
)

sv_feature_test(
    name = "operators_binary_tests",
    yaml = "sv_features/operators/binary.yaml",
)

sv_feature_test(
    name = "operators_unary_tests",
    yaml = "sv_features/operators/unary.yaml",
)

sv_feature_test(
    name = "processes_initial_tests",
    yaml = "sv_features/processes/initial.yaml",
)

sv_feature_test(
    name = "processes_timing_tests",
    yaml = "sv_features/processes/timing.yaml",
)

sv_feature_test(
    name = "processes_non_blocking_tests",
    yaml = "sv_features/processes/non_blocking.yaml",
)

sv_feature_test(
    name = "processes_wait_event_tests",
    yaml = "sv_features/processes/wait_event.yaml",
)

sv_feature_test(
    name = "control_flow_conditionals_tests",
    yaml = "sv_features/control_flow/conditionals.yaml",
)

sv_feature_test(
    name = "control_flow_loops_tests",
    yaml = "sv_features/control_flow/loops.yaml",
)

sv_feature_test(
    name = "control_flow_case_tests",
    yaml = "sv_features/control_flow/case.yaml",
)

sv_feature_test(
    name = "datatypes_variables_tests",
    yaml = "sv_features/datatypes/variables.yaml",
)

sv_feature_test(
    name = "datatypes_real_types_tests",
    yaml = "sv_features/datatypes/real_types.yaml",
)

sv_feature_test(
    name = "datatypes_shortreal_types_tests",
    yaml = "sv_features/datatypes/shortreal_types.yaml",
)

sv_feature_test(
    name = "datatypes_realtime_types_tests",
    yaml = "sv_features/datatypes/realtime_types.yaml",
)

sv_feature_test(
    name = "datatypes_arrays_tests",
    yaml = "sv_features/datatypes/arrays.yaml",
)

sv_feature_test(
    name = "display_basic_tests",
    yaml = "sv_features/display/basic.yaml",
)
