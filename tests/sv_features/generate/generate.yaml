feature: generate_generate
description: Tests generate constructs (if-generate, for-generate, and case-generate)

cases:
  - name: if_generate_initial
    description: Initial block inside generate
    sv: |
      module Test;
        parameter int ENABLE = 1;
        int value = 0;
        if (ENABLE) begin : gen_init
          initial begin
            value = 42;
            $display("value=%0d", value);
          end
        end
      endmodule
    expect:
      stdout: "value=42\n"

  - name: if_generate_false_no_code
    description: Condition is false, generated block not instantiated
    sv: |
      module Test;
        parameter int ENABLE = 0;
        int x = 5;
        if (ENABLE) begin : gen_block
          initial x = 100;
        end
        initial $display("x=%0d", x);
      endmodule
    expect:
      stdout: "x=5\n"

  - name: if_generate_variable
    description: Variable declared inside generate block
    sv: |
      module Test;
        parameter int USE_INTERNAL = 1;
        if (USE_INTERNAL) begin : gen_internal
          int internal_var;
          initial begin
            internal_var = 77;
            $display("result=%0d", internal_var);
          end
        end
      endmodule
    expect:
      stdout: "result=77\n"

  - name: if_generate_function
    description: Function defined inside generate block
    sv: |
      module Test;
        parameter int MODE = 1;
        if (MODE == 1) begin : gen_func
          function int multiply_by_two(int val);
            return val * 2;
          endfunction
          initial $display("x=%0d", multiply_by_two(21));
        end
      endmodule
    expect:
      stdout: "x=42\n"

  - name: nested_if_generate
    description: Nested if-generate constructs
    sv: |
      module Test;
        parameter int A = 1;
        parameter int B = 1;
        if (A) begin : gen_a
          if (B) begin : gen_b
            initial $display("A=1 B=1");
          end else begin : gen_not_b
            initial $display("A=1 B=0");
          end
        end else begin : gen_not_a
          initial $display("A=0");
        end
      endmodule
    expect:
      stdout: "A=1 B=1\n"

  - name: for_generate_basic
    description: Basic for-generate loop with genvar
    sv: |
      module Test;
        genvar i;
        for (i = 0; i < 4; i = i + 1) begin : blk
          initial $display("i=%0d", i);
        end
      endmodule
    expect:
      stdout: |
        i=0
        i=1
        i=2
        i=3

  - name: nested_for_generate
    description: Nested for-generate loops
    sv: |
      module Test;
        genvar i, j;
        for (i = 0; i < 2; i = i + 1) begin : outer
          for (j = 0; j < 2; j = j + 1) begin : inner
            initial $display("i=%0d j=%0d", i, j);
          end
        end
      endmodule
    expect:
      stdout: |
        i=0 j=0
        i=0 j=1
        i=1 j=0
        i=1 j=1

  - name: for_generate_with_if
    description: if-generate inside for-generate loop
    sv: |
      module Test;
        genvar i;
        for (i = 0; i < 4; i = i + 1) begin : blk
          if (i % 2 == 0) begin : even
            initial $display("even: %0d", i);
          end
        end
      endmodule
    expect:
      stdout: |
        even: 0
        even: 2

  - name: for_generate_zero_iterations
    description: for-generate with zero iterations
    sv: |
      module Test;
        genvar i;
        for (i = 0; i < 0; i = i + 1) begin : blk
          initial $display("never");
        end
        initial $display("done");
      endmodule
    expect:
      stdout:
        contains:
          - "done"
        not_contains:
          - "never"

  - name: case_generate_basic
    description: case-generate selecting initial block based on parameter
    sv: |
      module Test;
        parameter int WIDTH = 2;
        case (WIDTH)
          1: begin : gen
            initial $display("result=100");
          end
          2: begin : gen
            initial $display("result=200");
          end
          default: begin : gen
            initial $display("result=999");
          end
        endcase
      endmodule
    expect:
      stdout: "result=200\n"

  - name: case_generate_default
    description: case-generate falling through to default case
    sv: |
      module Test;
        parameter int WIDTH = 5;
        case (WIDTH)
          1: begin : gen
            initial $display("result=100");
          end
          2: begin : gen
            initial $display("result=200");
          end
          default: begin : gen
            initial $display("result=999");
          end
        endcase
      endmodule
    expect:
      stdout: "result=999\n"

  - name: case_generate_function
    description: Function defined inside case-generate block
    sv: |
      module Test;
        parameter int MODE = 1;
        case (MODE)
          0: begin : gen
            function int compute(int val);
              return val + 1;
            endfunction
            initial $display("x=%0d", compute(10));
          end
          1: begin : gen
            function int compute(int val);
              return val * 2;
            endfunction
            initial $display("x=%0d", compute(10));
          end
        endcase
      endmodule
    expect:
      stdout: "x=20\n"

  - name: for_generate_hierarchical_ref
    description: Hierarchical reference to variable inside for-generate block
    sv: |
      module Test;
        genvar i;
        for (i = 0; i < 2; i = i + 1) begin : gen_block
          int counter;
        end
        initial begin
          gen_block[0].counter = 10;
          gen_block[1].counter = 20;
          $display("gen_block[0].counter = %0d", gen_block[0].counter);
          $display("gen_block[1].counter = %0d", gen_block[1].counter);
        end
      endmodule
    expect:
      stdout: "gen_block[0].counter = 10\ngen_block[1].counter = 20\n"

  - name: for_generate_hierarchical_ref_multiple_vars
    description: Hierarchical reference to multiple variables inside for-generate
    sv: |
      module Test;
        genvar i;
        for (i = 0; i < 3; i = i + 1) begin : blk
          int x;
          int y;
        end
        initial begin
          blk[0].x = 1; blk[0].y = 2;
          blk[1].x = 10; blk[1].y = 20;
          blk[2].x = 100; blk[2].y = 200;
          $display("%0d %0d %0d %0d %0d %0d",
            blk[0].x, blk[0].y, blk[1].x, blk[1].y, blk[2].x, blk[2].y);
        end
      endmodule
    expect:
      stdout: "1 2 10 20 100 200\n"

  - name: if_generate_hierarchical_ref
    description: Hierarchical reference to variable inside if-generate block
    sv: |
      module Test;
        parameter bit ENABLE = 1;
        if (ENABLE) begin : enabled
          int value;
        end
        initial begin
          enabled.value = 42;
          $display("enabled.value = %0d", enabled.value);
        end
      endmodule
    expect:
      stdout: "enabled.value = 42\n"

  - name: nested_for_generate_variables
    description: Variables in nested for-generate blocks with hierarchical access
    sv: |
      module Test;
        genvar i, j;
        for (i = 0; i < 2; i = i + 1) begin : outer
          int x;
          for (j = 0; j < 2; j = j + 1) begin : inner
            int y;
          end
        end
        initial begin
          outer[0].x = 10;
          outer[1].x = 20;
          outer[0].inner[0].y = 100;
          outer[0].inner[1].y = 101;
          outer[1].inner[0].y = 200;
          outer[1].inner[1].y = 201;
          $display("outer[0].x=%0d outer[1].x=%0d", outer[0].x, outer[1].x);
          $display("outer[0].inner[0].y=%0d outer[0].inner[1].y=%0d",
            outer[0].inner[0].y, outer[0].inner[1].y);
          $display("outer[1].inner[0].y=%0d outer[1].inner[1].y=%0d",
            outer[1].inner[0].y, outer[1].inner[1].y);
        end
      endmodule
    expect:
      stdout: "outer[0].x=10 outer[1].x=20\nouter[0].inner[0].y=100 outer[0].inner[1].y=101\nouter[1].inner[0].y=200 outer[1].inner[1].y=201\n"

  - name: nested_if_in_for_generate_variables
    description: Variables in if-generate nested inside for-generate
    sv: |
      module Test;
        genvar i;
        for (i = 0; i < 2; i = i + 1) begin : outer
          int x;
          if (i == 0) begin : inner
            int y;
          end
        end
        initial begin
          outer[0].x = 10;
          outer[1].x = 20;
          outer[0].inner.y = 42;
          $display("outer[0].x=%0d outer[1].x=%0d", outer[0].x, outer[1].x);
          $display("outer[0].inner.y=%0d", outer[0].inner.y);
        end
      endmodule
    expect:
      stdout: "outer[0].x=10 outer[1].x=20\nouter[0].inner.y=42\n"

  - name: nested_for_in_if_generate_variables
    description: Variables in for-generate nested inside if-generate
    sv: |
      module Test;
        parameter bit ENABLE = 1;
        genvar i;
        if (ENABLE) begin : outer
          int x;
          for (i = 0; i < 2; i = i + 1) begin : inner
            int y;
          end
        end
        initial begin
          outer.x = 10;
          outer.inner[0].y = 100;
          outer.inner[1].y = 200;
          $display("outer.x=%0d", outer.x);
          $display("outer.inner[0].y=%0d outer.inner[1].y=%0d",
            outer.inner[0].y, outer.inner[1].y);
        end
      endmodule
    expect:
      stdout: "outer.x=10\nouter.inner[0].y=100 outer.inner[1].y=200\n"
