feature: non_blocking
description: Tests for non-blocking assignments (<=)

cases:
  - name: simple_non_blocking
    sv: |
      module Test;
        int a, b;

        initial begin
          a = 1;
          b <= a + 1;
          a = 5;
        end
      endmodule
    expect:
      variables:
        a: 5
        b: 2

  - name: blocking_then_non_blocking
    sv: |
      module Test;
        int a, b;
        initial begin
          a = 1;
          b <= a;
        end
      endmodule
    expect:
      variables:
        a: 1
        b: 1

  - name: multiple_non_blocking
    sv: |
      module Test;
        int a, b;
        initial begin
          a <= 1;
          b <= 2;
        end
      endmodule
    expect:
      variables:
        a: 1
        b: 2

  - name: register_with_clock
    sv: |
      module Test;
        bit clk;
        int d, q;

        initial begin
          clk = 0;
          forever #5 clk = ~clk;
        end

        always_ff @(posedge clk)
          q <= d;

        initial begin
          d = 42;
          #12;
          d = 99;
          #10;
          $finish();
        end
      endmodule
    expect:
      variables:
        q: 99
      time: 22

  - name: register_with_enable
    sv: |
      module Test;
        bit clk, en;
        int d, q;

        initial begin
          clk = 0;
          forever #5 clk = ~clk;
        end

        always_ff @(posedge clk) begin
          if (en)
            q <= d;
        end

        initial begin
          en = 1;
          d = 42;
          #10;
          d = 99;
          #10;
          en = 0;
          d = 7;
          #10;
          $finish();
        end
      endmodule
    expect:
      variables:
        q: 99
      time: 30

  - name: pipelined_non_blocking
    sv: |
      module Test;
        int d, q1, q2;
        bit clk;

        always_ff @(posedge clk) begin
          q1 <= d;
          q2 <= q1;
        end

        initial begin
          d = 10;
          clk = 0;
          #5 clk = 1;
          #5 clk = 0;
          #5 clk = 1;
          #5 clk = 0;
          $finish();
        end
      endmodule
    expect:
      variables:
        q1: 10
        q2: 10
      time: 20

  - name: array_element_write
    description: NBA to array element should update the specific element
    sv: |
      module Test;
        logic [7:0] arr[4];
        initial begin
          arr[0] = 8'd10;
          arr[1] = 8'd20;
          arr[2] = 8'd30;
          arr[3] = 8'd40;
          #1;
          arr[1] <= 8'd99;
          $display("before: %0d", arr[1]);
          #1;
          $display("after: %0d", arr[1]);
        end
      endmodule
    expect:
      output: |
        before: 20
        after: 99
