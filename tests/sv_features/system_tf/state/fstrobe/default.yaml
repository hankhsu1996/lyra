feature: file_strobe
description: Tests for $fstrobe system task (file-directed strobe, deferred to Postponed region)

cases:
  - name: fstrobe_basic
    description: $fstrobe writes to file in Postponed region
    files:
      - name: test.sv
        content: |
          module Test;
            initial begin
              $fstrobe(1, "strobe output");
              $display("display first");
            end
          endmodule
    expect:
      stdout: |
        display first
        strobe output

  - name: fstrobe_format_string
    description: $fstrobe with format arguments
    files:
      - name: test.sv
        content: |
          module Test;
            int x = 42;
            initial begin
              $fstrobe(1, "x=%d", x);
            end
          endmodule
    expect:
      stdout: |
        x=42

  - name: fstrobeh_hex
    description: $fstrobeh uses hex format (full width for int)
    files:
      - name: test.sv
        content: |
          module Test;
            initial begin
              $fstrobeh(1, 255);
            end
          endmodule
    expect:
      stdout: |
        000000ff

  - name: fstrobe_after_fclose
    description: $fstrobe to closed file is silently ignored
    files:
      - name: test.sv
        content: |
          module Test;
            int fd;
            initial begin
              fd = $fopen("output.txt", "w");
              $fstrobe(fd, "should not appear");
              $fclose(fd);
              $display("done");
            end
          endmodule
    expect:
      stdout: |
        done

  - name: fstrobe_after_fclose_file_empty
    description: $fstrobe to closed file produces empty file
    files:
      - name: test.sv
        content: |
          module Test;
            int fd;
            initial begin
              fd = $fopen("output.txt", "w");
              $fstrobe(fd, "should not appear");
              $fclose(fd);
            end
          endmodule
    expect:
      files:
        output.txt: ""
