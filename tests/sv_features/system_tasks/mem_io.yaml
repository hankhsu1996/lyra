feature: mem_io
description: Tests for $readmemh/$readmemb and $writememh/$writememb

cases:
  - name: readmemh_basic
    files:
      - name: test.sv
        content: |
          module Test;
            logic [7:0] mem [0:3];
            logic [7:0] a0, a1, a2, a3;
            initial begin
              $readmemh("mem.hex", mem);
              a0 = mem[0];
              a1 = mem[1];
              a2 = mem[2];
              a3 = mem[3];
            end
          endmodule
      - name: mem.hex
        content: |
          00
          01
          0a
          ff
    expect:
      variables:
        a0: 0
        a1: 1
        a2: 10
        a3: 255

  - name: readmemh_with_address
    files:
      - name: test.sv
        content: |
          module Test;
            logic [7:0] mem [0:15];
            logic [7:0] a10, a11;
            initial begin
              $readmemh("mem.hex", mem);
              a10 = mem[10];
              a11 = mem[11];
            end
          endmodule
      - name: mem.hex
        content: |
          @0A
          0f
          1a
    expect:
      variables:
        a10: 15
        a11: 26

  - name: readmemb_basic
    files:
      - name: test.sv
        content: |
          module Test;
            logic [3:0] mem [0:3];
            logic [3:0] b0, b1, b2, b3;
            initial begin
              $readmemb("mem.bin", mem);
              b0 = mem[0];
              b1 = mem[1];
              b2 = mem[2];
              b3 = mem[3];
            end
          endmodule
      - name: mem.bin
        content: |
          0001
          0010
          0100
          1000
    expect:
      variables:
        b0: 1
        b1: 2
        b2: 4
        b3: 8

  - name: readmemh_packed_element_array
    files:
      - name: test.sv
        content: |
          module Test;
            logic [15:0] packed_mem [0:1];
            logic [15:0] b0, b1;
            initial begin
              $readmemh("mem.hex", packed_mem);
              b0 = packed_mem[0];
              b1 = packed_mem[1];
            end
          endmodule
      - name: mem.hex
        content: |
          1234
          abcd
    expect:
      variables:
        b0: 4660
        b1: 43981

  - name: writememh_roundtrip
    files:
      - name: test.sv
        content: |
          module Test;
            logic [7:0] mem [0:3];
            logic [7:0] mem2 [0:3];
            logic [7:0] c0, c1, c2, c3;
            initial begin
              mem[0] = 8'h11;
              mem[1] = 8'h22;
              mem[2] = 8'h33;
              mem[3] = 8'h44;
              $writememh("out.hex", mem);
              $readmemh("out.hex", mem2);
              c0 = mem2[0];
              c1 = mem2[1];
              c2 = mem2[2];
              c3 = mem2[3];
            end
          endmodule
    expect:
      variables:
        c0: 17
        c1: 34
        c2: 51
        c3: 68

  - name: packed_array_basic
    files:
      - name: test.sv
        content: |
          module Test;
            logic [3:0][7:0] packed_mem;
            logic [7:0] p0, p1, p2, p3;
            initial begin
              packed_mem[0] = 8'h11;
              packed_mem[1] = 8'h22;
              packed_mem[2] = 8'h33;
              packed_mem[3] = 8'h44;
              p0 = packed_mem[0];
              p1 = packed_mem[1];
              p2 = packed_mem[2];
              p3 = packed_mem[3];
            end
          endmodule
    expect:
      variables:
        p0: 17
        p1: 34
        p2: 51
        p3: 68
